import{M as y}from"./Modal.5044384c.js";import{_ as g,b as c,o as a,h as f,e as p,a as t,d as m,m as B,c as _,t as w,F as C,z as x,k as v,n as M,T as b,g as k}from"./index.e2c66d80.js";import{A as T,S as d}from"./api.9cb1a443.js";import{D as j}from"./trash.a549f6e6.js";import{C as N}from"./NewDocument.5870aa86.js";import"./JsonEditor.794bd79a.js";import"./JsonInput.da829317.js";import"./N-Button.66bfda2d.js";const A={name:"NewDocumentModal",components:{Modal:y,CreateDocument:N},emits:["created"],methods:{show(){this.$refs.modal.show()},onCreated(e){this.$refs.modal.hide(),this.$emit("created",e)}}},S={class:"new-document"};function V(e,o,i,l,s,n){const u=c("CreateDocument"),h=c("Modal");return a(),f(h,{ref:"modal"},{default:p(()=>[t("div",S,[m(u,{ref:"create",onCreated:n.onCreated,onCancel:o[0]||(o[0]=D=>e.$refs.modal.hide())},null,8,["onCreated"])])]),_:1},512)}var I=g(A,[["render",V]]);const L={name:"ManageDocuments",components:{NewDocumentModal:I,CreateDocument:N,Modal:y,DeleteIcon:j},setup(){const{project:e,collection:o}=B().params,i=T.Documents(e,o);return{project:e,collection:o,api:i}},data(){return{documents:[],newDoc:"",count:null,fetching:!1}},computed:{doc(){return this.$route.params._id}},mounted(){this.fetchData()},methods:{onNewDocumentCreated(e){this.fetchData(),this.$refs.modal.hide(),this.$router.replace({name:"document",params:{_id:e._id}})},async submit(){await this.api.create(JSON.parse(this.newDoc)),this.$refs.modal.hide(),this.newDoc="",await this.fetchData()},async fetchData(){this.fetching=!0;try{const{data:e}=await this.api.find({},{},{sort:{createdAt:-1}});this.documents=e,this.fetchCount()}catch(e){console.error(e)}finally{this.fetching=!1}},async removeDocument(e){const{isConfirmed:o}=await d.fire({title:"Delete Document",text:"Are you sure?",cancelButtonText:"cancel",customClass:{confirmButton:"danger",cancelButton:"secondary"},confirmButtonText:"Yes, Delete it",showCancelButton:!0,preConfirm:async i=>{if(i){d.showLoading(d.getConfirmButton());try{const{data:l}=await this.api.deleteOne({_id:e._id});let{collection:s,project:n}=this;this.$router.replace({name:"documents",params:{project:n,collection:s}}).then(),await this.fetchData(),d.close()}finally{d.hideLoading()}}}})},async fetchCount(){const{data:e}=await this.api.count();this.count=e}}},z={class:"Documents"},F={class:"header"},O=k(" Documents "),E={class:"opacity-50"},J={class:"items"},R=["onClick"],Y=t("div",{class:"item h-8 skeloading"},null,-1),q=t("div",{class:"item h-8 skeloading"},null,-1),G=t("div",{class:"item h-8 skeloading"},null,-1),H={class:"document relative"};function K(e,o,i,l,s,n){const u=c("DeleteIcon"),h=c("router-link"),D=c("router-view"),$=c("NewDocumentModal");return a(),_("div",z,[t("div",{class:M(["side-bar card",{hide:!!n.doc}])},[t("div",F,[O,t("span",E," #"+w(s.count),1)]),t("button",{class:"btn btn-sm btn-text",onClick:o[0]||(o[0]=r=>e.$refs.modal.show())}," New Document "),t("div",J,[s.fetching?v("",!0):(a(!0),_(C,{key:0},x(s.documents,r=>(a(),f(h,{key:r._id,class:"item",to:{name:"document",params:{project:l.project,collection:l.collection,_id:r._id}}},{default:p(()=>[k(w(r._id.substr(8))+" ",1),t("div",{class:"drop",onClick:P=>n.removeDocument(r)},[m(u,{class:"fill-red-500 opacity-75",width:"24",height:"24"})],8,R)]),_:2},1032,["to"]))),128)),s.fetching?(a(),_(C,{key:1},[Y,q,G],64)):v("",!0)])],2),t("div",H,[m(b,{name:"fade"},{default:p(()=>[(a(),f(D,{key:n.doc,onDeleteDocument:n.removeDocument},null,8,["onDeleteDocument"]))]),_:1})]),m($,{ref:"modal",onCreated:n.onNewDocumentCreated},null,8,["onCreated"])])}var ne=g(L,[["render",K]]);export{ne as default};
