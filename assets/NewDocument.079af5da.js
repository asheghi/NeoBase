var w=Object.defineProperty;var x=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var b=(e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))N.call(t,n)&&b(e,n,t[n]);if(x)for(var n of x(t))S.call(t,n)&&b(e,n,t[n]);return e};import{o as a,c as r,a as o,_ as y,b as f,t as u,d as g,k as $,F as j,z as B,h as F,m as I,r as k,p as M,e as U,g as J,n as O}from"./index.3c335428.js";import{g as D,A,t as V}from"./api.9e09c6a2.js";import{J as E}from"./JsonEditor.f1f98d7c.js";import{J as R}from"./JsonInput.c744a629.js";import{N as K}from"./N-Button.1e8f368b.js";const C={xmlns:"http://www.w3.org/2000/svg",class:"ionicon",viewBox:"0 0 512 512"},q=o("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),z=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 256H176"},null,-1),L=[q,z];function T(e,t){return a(),r("svg",C,L)}C.width="24";C.height="24";var H={render:T};const W={name:"DocumentField",components:{RemoveIcon:H},props:{fieldKey:{type:String,required:!0,default:""},fieldValue:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{selected_type:null}},computed:{type(){const{selected_type:e}=this;if(e)return e;if(!String(this.fieldValue))return"text";const t=typeof this.fieldValue;if(console.log("typeof ",t),t==="boolean")return"boolean";if(t==="string"&&this.fieldValue.length===24&&this.fieldValue.endsWith("Z"))return"date-time";if(t==="object"){if(Array.isArray(this.fieldValue))return"array";if(this.fieldValue)return"object"}return isNaN(this.fieldValue)?"text":"number"}}},Z={class:"Field"},G={class:"key"},P=o("label",{for:"key"},"Field",-1),Q=["value"],X=o("div",{class:"dotted-line"},null,-1),Y=o("div",{class:"equal"},"=",-1),ee={class:"type"},te=o("label",{for:"type"},"Type",-1),ne=["value"],oe=["textContent"],de=["textContent"],ie=["textContent"],le=["textContent"],ae=["textContent"],se=["textContent"],ue={class:"value"},re=o("label",{for:"value"},"Value",-1),ce=o("br",null,null,-1),me=["value"],he=["value"],_e=["value"],fe=["textContent"],pe=["textContent"],ve=["value"],ge={key:0,class:"remove-icon"};function ye(e,t,n,c,s,i){const l=f("RemoveIcon");return a(),r("div",Z,[o("div",G,[P,o("input",{id:"key",name:"key",value:n.fieldKey,placeholder:"key",onChange:t[0]||(t[0]=d=>e.$emit("update:field-key",d.target.value,n.fieldKey))},null,40,Q),X]),Y,o("div",ee,[te,o("select",{id:"type",value:i.type,onChange:t[1]||(t[1]=d=>s.selected_type=d.target.value)},[o("option",{value:"text",textContent:u("text")},null,8,oe),o("option",{value:"number",textContent:u("number")},null,8,de),o("option",{value:"boolean",textContent:u("boolean")},null,8,ie),o("option",{value:"date-time",textContent:u("date-time")},null,8,le),o("option",{value:"array",textContent:u("array")},null,8,ae),o("option",{value:"map",textContent:u("map")},null,8,se)],40,ne)]),o("div",ue,[re,ce,i.type==="number"?(a(),r("input",{key:0,id:"value",type:"number",value:n.fieldValue,name:"value",placeholder:"value",onChange:t[2]||(t[2]=d=>e.$emit("update:field-value",+d.target.value))},null,40,me)):i.type==="text"?(a(),r("input",{key:1,id:"value",value:n.fieldValue,name:"value",placeholder:"value",onChange:t[3]||(t[3]=d=>e.$emit("update:field-value",d.target.value))},null,40,he)):i.type==="boolean"?(a(),r("select",{key:2,id:"type",value:n.fieldValue,onChange:t[4]||(t[4]=d=>e.$emit("update:field-value",Boolean(d.target.value)))},[o("option",{value:!0,textContent:u("true")},null,8,fe),o("option",{value:!1,textContent:u("false")},null,8,pe)],40,_e)):(a(),r("textarea",{key:3,id:"type",value:n.fieldValue,onChange:t[5]||(t[5]=d=>e.$emit("update:field-value",JSON.parse(d.target.value)))},null,40,ve))]),n.fieldKey?(a(),r("button",ge,[g(l,{class:"icon",width:"24",height:"24",onClick:t[6]||(t[6]=d=>e.$emit("remove"))})])):$("",!0)])}var Ce=y(W,[["render",ye]]);const v=D("document-editor"),xe={name:"DocumentEditor",components:{DocumentField:Ce},props:{modelValue:{default:{}}},data(){return{document:this.modelValue||{"":""},render_counter:1}},watch:{render_counter(){Object.keys(this.document).find(e=>e==="")||(this.document[""]="")}},mounted(){this.render_counter++},methods:{onKeyChange(e,t){v.debug(`on key changed, new:${e}, old:${t}`),this.document[String(e)]=this.document[t],delete this.document[t],v.debug("after: ",this.document),this.render_counter++,this.fireUpdate()},onValueChanged(e,t){v.debug("onValueChanged",e,typeof e,t,typeof t),this.document[String(e)]=t,this.render_counter++,this.fireUpdate()},fireUpdate(){const e=p({},this.document);delete e[""],console.log("check",e),this.$emit("update:modelValue",e)},removeField(e){!e||(delete this.document[e],this.fireUpdate())}}},be={class:"DocumentEditor"};function ke(e,t,n,c,s,i){const l=f("DocumentField");return a(),r("div",be,[(a(!0),r(j,null,B(Object.keys(s.document),(d,m)=>(a(),F(l,{key:m,"field-key":String(d),"field-value":s.document[d],"onUpdate:fieldKey":i.onKeyChange,"onUpdate:fieldValue":h=>i.onValueChanged(d,h),onRemove:h=>i.removeField(d)},null,8,["field-key","field-value","onUpdate:fieldKey","onUpdate:fieldValue","onRemove"]))),128))])}var Ve=y(xe,[["render",ke]]);const _=D("create-document"),De={name:"CreateDocument",components:{NButton:K,JsonInput:R,JsonEditor:E,DocumentEditor:Ve},props:{doc:{type:Object,default:()=>({foo:"bar"})},hideId:{type:Boolean,default:!1,required:!1}},emits:["created","cancel"],setup(e){const{project:t,collection:n}=I().params,c=k("json"),s=M(()=>c.value==="json"?"editor":"json"),i=()=>{c.value=s.value},l=p({},e.doc),d=e.doc._id?String(e.doc._id):null,m=d?"edit":"create";delete l._id,delete l.createdAt,delete l.updatedAt,delete l.createdBy,delete l.__v;const h=k(l);return{documentId:d,mode:m,document:h,project:t,collection:n,api:A.Documents(t,n),currentMode:c,alternateMode:s,toggleMode:i}},data(){return{loading:!1}},computed:{document_id(){return this.mode==="create"?"new ObjectId()":this.document_id}},methods:{async createDocument(){if(!this.document){_.error("this.document is not defined!",this.document);return}""in this.document&&delete this.document[""];try{this.loading=!0;const{data:e}=await this.api.create(this.document);this.$emit("created",e),V("created new document")}catch(e){_.error(e)}finally{this.loading=!1}},async updateDocument(){if(!this.document){_.error("this.document is not defined!",this.document);return}try{""in this.document&&delete this.document[""];const e={_id:this.document_id};this.loading=!0,await this.api.updateOne(e,this.document),this.$emit("updated",this.document_id),V("updated document")}catch(e){_.error(e)}finally{this.loading=!1}},onCancel(){this.$emit("cancel",!0)},toggleAlternateMode(){this.currentMode=this.alternateMode},onSave(){this.mode==="edit"?this.updateDocument():this.createDocument()},updatedJson(e){console.log("check arg",e)}}},we={class:"buttons"},Ne=["textContent"];function Se(e,t,n,c,s,i){const l=f("JsonInput"),d=f("NButton");return a(),r("div",{class:O(["NewDocument","mode-"+c.currentMode])},[g(l,{modelValue:c.document,"onUpdate:modelValue":t[0]||(t[0]=m=>c.document=m)},null,8,["modelValue"]),o("div",we,[o("button",{class:"text-primary dark:text-white",onClick:t[1]||(t[1]=(...m)=>i.onCancel&&i.onCancel(...m)),textContent:u("cancel")},null,8,Ne),g(d,{loading:s.loading,class:"primary",onClick:i.onSave},{default:U(()=>[J(u(s.loading?"Saving":"Save"),1)]),_:1},8,["loading","onClick"])])],2)}var Ue=y(De,[["render",Se]]);export{Ue as C};
