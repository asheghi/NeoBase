import{M as C}from"./Modal.2e544910.js";import{_ as y,k,a as s,o as a,c as m,d as o,y as _,x as b,F as N,t as g,b as r,T as x,e as l,h,g as j}from"./index.a259c8be.js";import{A as M}from"./api.2151525c.js";import{D as $}from"./trash.8406b46c.js";import{C as B}from"./NewDocument.e4783755.js";import"./JsonEditor.ba11ed47.js";const V={name:"ManageDocuments",components:{CreateDocument:B,Modal:C,DeleteIcon:$},setup(){const{project:e,collection:t}=k().params,c=M.Documents(e,t);return{project:e,collection:t,api:c}},data(){return{documents:[],newDoc:"",count:null}},computed:{doc(){return this.$route.params._id}},mounted(){this.fetchData()},methods:{onNewDocumentCreated(e){this.fetchData(),this.$refs.modal.hide(),this.$router.replace({name:"document",params:{_id:e._id}})},async submit(){await this.api.create(JSON.parse(this.newDoc)),this.$refs.modal.hide(),this.newDoc="",await this.fetchData()},async fetchData(){const{data:e}=await this.api.find({},{},{sort:{createdAt:-1}});this.documents=e,this.fetchCount()},async removeDocument(e){await this.api.deleteOne({_id:e._id});let{collection:t,project:c}=this;this.$router.replace({name:"documents",params:{project:c,collection:t}}).then(),await this.fetchData()},async fetchCount(){const{data:e}=await this.api.count();this.count=e}}},A={class:"Documents"},I={class:"side-bar"},T={class:"head flex justify-between items-center w-full"},F=o("h1",{class:""},"Documents",-1),O={key:0,class:"count"},S={class:"items"},E=["onClick"],J={class:"document relative"},L={class:"new-document"};function R(e,t,c,u,d,i){const p=s("DeleteIcon"),D=s("router-link"),f=s("router-view"),v=s("CreateDocument"),w=s("Modal");return a(),m("div",A,[o("div",I,[o("div",T,[F,d.count?(a(),m("div",O,_(d.count)+"#",1)):b("",!0)]),o("button",{class:"btn btn-sm btn-text",onClick:t[0]||(t[0]=n=>e.$refs.modal.show())}," New Document "),o("div",S,[(a(!0),m(N,null,g(d.documents,n=>(a(),h(D,{class:"item",to:{name:"document",params:{project:u.project,collection:u.collection,_id:n._id}}},{default:l(()=>[j(_(n._id.substring(10))+" ",1),o("div",{class:"drop",onClick:q=>i.removeDocument(n)},[r(p,{class:"fill-red-500 opacity-75",width:"24",height:"24"})],8,E)]),_:2},1032,["to"]))),256))])]),o("div",J,[r(x,{name:"fade"},{default:l(()=>[(a(),h(f,{key:i.doc,onDeleteDocument:i.removeDocument},null,8,["onDeleteDocument"]))]),_:1})]),r(w,{ref:"modal"},{default:l(()=>[o("div",L,[r(v,{onCreated:i.onNewDocumentCreated,onCancel:t[1]||(t[1]=n=>e.$refs.modal.hide())},null,8,["onCreated"])])]),_:1},512)])}var U=y(V,[["render",R]]);export{U as default};
