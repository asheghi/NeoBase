import{_ as U,o as i,a as l,b as s,p as h,v as w,e as _,w as f,g as b,m as B,u as k,d,c as D,F as g,j as M,k as y,n as V,T,h as v,t as A}from"./index.af53e14a.js";import{A as N,s as m,t as E}from"./api.6f9d2f33.js";import{N as F}from"./N-Button.df8eb929.js";import{M as K}from"./Modal.e5bc137a.js";const L={name:"NewUser",components:{NButton:F},emits:["created"],setup(){return k(),{api:N.Users()}},data(){return{form:{},loading:!1}},methods:{async submit(){if(!this.loading){this.loading=!0;try{const t=this.form,{data:e,status:c}=await this.api.newUser(t);this.$emit("created",e)}finally{this.loading=!1}}}}},R={class:"NewUser"},S={class:"form-group"},j=s("label",{for:"email"},"Email",-1),z=["disabled"],P={class:"form-group"},Y=s("label",{for:"password"},"Password",-1),q=["disabled"],G={class:"form-group"},H=s("label",{for:"role"},"Role:",-1),I=["disabled"];function J(t,e,c,u,o,r){const p=d("NButton");return i(),l("div",R,[s("div",{class:"form",onKeydown:e[3]||(e[3]=B((...a)=>r.submit&&r.submit(...a),["enter"]))},[s("div",S,[j,h(s("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=a=>o.form.email=a),name:"email",type:"email",disabled:o.loading,placeholder:"enter your email address"},null,8,z),[[w,o.form.email]])]),s("div",P,[Y,h(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>o.form.password=a),name:"password",type:"password",disabled:o.loading,placeholder:"enter a secure password"},null,8,q),[[w,o.form.password]])]),s("div",G,[H,h(s("input",{id:"role","onUpdate:modelValue":e[2]||(e[2]=a=>o.form.role=a),name:"role",type:"text",disabled:o.loading,placeholder:"enter a user role"},null,8,I),[[w,o.form.role]])]),_(p,{loading:o.loading,class:"primary",onClick:r.submit},{default:f(()=>[b(" Submit ")]),_:1},8,["loading","onClick"])],32)])}var O=U(L,[["render",J]]);const Q={name:"Users",components:{Modal:K,NewUser:O},setup(){const t=k();return{uid:D(()=>t.params.uid)}},data(){return{users:[],fetching:!1}},computed:{api(){return N.Users()}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:t}=await this.api.find();this.users=t}catch(t){console.error(t)}finally{this.fetching=!1}},showNewUserModal(){this.$refs.modal.show()},async deleteUser(t){await m.fire({title:"Delete User",html:"Are you sure?",cancelButtonText:"cancel",customClass:{confirmButton:"danger",cancelButton:"secondary"},confirmButtonText:"Yes, Delete it",showCancelButton:!0,preConfirm:async e=>{if(e){m.showLoading(m.getConfirmButton());try{await this.api.deleteUser(t),await this.fetchData(),await this.$router.replace({name:"auth"}),E("Deleted User"),m.close()}catch(c){console.error(c)}return!1}return!1}})},async onCreated(t){this.$refs.modal.hide(),await this.fetchData(),await this.$router.push({name:"user",params:{uid:t._id}})}}},W={class:"Users"},X=s("div",{class:"header"},"Users",-1),Z={class:"items"},$=s("div",{class:"item h-8 skeloading"},null,-1),ee=s("div",{class:"item h-8 skeloading"},null,-1),se=s("div",{class:"item h-8 skeloading"},null,-1),te={key:0,class:"card user-info"};function oe(t,e,c,u,o,r){const p=d("router-link"),a=d("router-view"),x=d("NewUser"),C=d("Modal");return i(),l("div",W,[s("div",{class:V(["side-bar card",{showingUser:u.uid}])},[X,s("button",{class:"px-4 text-primary dark:text-primary-300 font-bold py-2",onClick:e[0]||(e[0]=(...n)=>r.showNewUserModal&&r.showNewUserModal(...n))}," New User "),s("div",Z,[o.fetching?y("",!0):(i(!0),l(g,{key:0},M(o.users,n=>(i(),v(p,{key:n,to:{name:"user",params:{uid:n._id}},class:"item name"},{default:f(()=>[b(A(n.email),1)]),_:2},1032,["to"]))),128)),o.fetching?(i(),l(g,{key:1},[$,ee,se],64)):y("",!0)])],2),u.uid?(i(),l("div",te,[_(T,{name:"fade"},{default:f(()=>[(i(),v(a,{key:u.uid,onDelete:e[1]||(e[1]=n=>r.deleteUser(n))}))]),_:1})])):y("",!0),_(C,{ref:"modal"},{default:f(()=>[_(x,{onCreated:r.onCreated},null,8,["onCreated"])]),_:1},512)])}var le=U(Q,[["render",oe]]);export{le as default};
