import{M as y}from"./Modal.85e7a6c6.js";import{_ as g,b as c,o as a,h as f,e as p,a as o,d as m,m as B,c as _,t as w,F as C,z as x,k as v,n as M,T as b,g as k}from"./index.cdcacdc3.js";import{A as j,S as d}from"./api.9e09c6a2.js";import{D as T}from"./trash.d071f0d1.js";import{C as $}from"./NewDocument.126dbef4.js";import"./JsonEditor.7fd89b09.js";import"./JsonInput.8fc06401.js";import"./N-Button.ff915318.js";const A={name:"NewDocumentModal",components:{Modal:y,CreateDocument:$},emits:["created"],methods:{show(){this.$refs.modal.show()},onCreated(e){this.$refs.modal.hide(),this.$emit("created",e)}}},S={class:"new-document"};function V(e,t,r,l,s,n){const u=c("CreateDocument"),h=c("Modal");return a(),f(h,{ref:"modal"},{default:p(()=>[o("div",S,[m(u,{ref:"create",onCreated:n.onCreated,onCancel:t[0]||(t[0]=D=>e.$refs.modal.hide())},null,8,["onCreated"])])]),_:1},512)}var I=g(A,[["render",V]]);const L={name:"ManageDocuments",components:{NewDocumentModal:I,CreateDocument:$,Modal:y,DeleteIcon:T},setup(){const{project:e,collection:t}=B().params,r=j.Documents(e,t);return{project:e,collection:t,api:r}},data(){return{documents:[],newDoc:"",count:null,fetching:!1}},computed:{doc(){return this.$route.params._id}},watch:{"$route.params.project":{handler(e,t){e&&this.$router.push({name:"collections",params:{project:e}})}}},mounted(){this.fetchData()},methods:{onNewDocumentCreated(e){this.fetchData(),this.$refs.modal.hide(),this.$router.replace({name:"document",params:{_id:e._id}})},async submit(){await this.api.create(JSON.parse(this.newDoc)),this.$refs.modal.hide(),this.newDoc="",await this.fetchData()},async fetchData(){this.fetching=!0;try{const{data:e}=await this.api.find({},{},{sort:{createdAt:-1}});this.documents=e,this.fetchCount()}catch(e){console.error(e)}finally{this.fetching=!1}},async removeDocument(e){const{isConfirmed:t}=await d.fire({title:"Delete Document",text:"Are you sure?",cancelButtonText:"cancel",customClass:{confirmButton:"danger",cancelButton:"secondary"},confirmButtonText:"Yes, Delete it",showCancelButton:!0,preConfirm:async r=>{if(r){d.showLoading(d.getConfirmButton());try{const{data:l}=await this.api.deleteOne({_id:e._id});let{collection:s,project:n}=this;this.$router.replace({name:"documents",params:{project:n,collection:s}}).then(),await this.fetchData(),d.close()}finally{d.hideLoading()}}}})},async fetchCount(){const{data:e}=await this.api.count();this.count=e}}},z={class:"Documents"},F={class:"header"},O=k(" Documents "),E={class:"opacity-50"},J={class:"items"},R=["onClick"],Y=o("div",{class:"item h-8 skeloading"},null,-1),q=o("div",{class:"item h-8 skeloading"},null,-1),G=o("div",{class:"item h-8 skeloading"},null,-1),H={class:"document relative"};function K(e,t,r,l,s,n){const u=c("DeleteIcon"),h=c("router-link"),D=c("router-view"),N=c("NewDocumentModal");return a(),_("div",z,[o("div",{class:M(["side-bar card",{hide:!!n.doc}])},[o("div",F,[O,o("span",E," #"+w(s.count),1)]),o("button",{class:"btn btn-sm btn-text",onClick:t[0]||(t[0]=i=>e.$refs.modal.show())}," New Document "),o("div",J,[s.fetching?v("",!0):(a(!0),_(C,{key:0},x(s.documents,i=>(a(),f(h,{key:i._id,class:"item",to:{name:"document",params:{project:l.project,collection:l.collection,_id:i._id}}},{default:p(()=>[k(w(i._id.substr(8))+" ",1),o("div",{class:"drop",onClick:P=>n.removeDocument(i)},[m(u,{class:"fill-red-500 opacity-75",width:"24",height:"24"})],8,R)]),_:2},1032,["to"]))),128)),s.fetching?(a(),_(C,{key:1},[Y,q,G],64)):v("",!0)])],2),o("div",H,[m(b,{name:"fade"},{default:p(()=>[(a(),f(D,{key:n.doc,onDeleteDocument:n.removeDocument},null,8,["onDeleteDocument"]))]),_:1})]),m(N,{ref:"modal",onCreated:n.onNewDocumentCreated},null,8,["onCreated"])])}var ne=g(L,[["render",K]]);export{ne as default};
