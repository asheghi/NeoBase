import{M as C}from"./Modal.2d1d5b4a.js";import{_ as k,k as y,f as s,o as a,c as d,b as o,x as _,t as b,F as N,q as g,a as r,T as x,w as l,g as h,e as j}from"./index.7aedd7d3.js";import{A as M}from"./api.02e2fd90.js";import{D as $}from"./trash.e310b9af.js";import{C as B}from"./NewDocument.aca4c492.js";import"./JsonEditor.7c4aa15c.js";const V={name:"ManageDocuments",components:{CreateDocument:B,Modal:C,DeleteIcon:$},setup(){const{project:e,collection:t}=y().params,c=M.Documents(e,t);return{project:e,collection:t,api:c}},data(){return{documents:[],newDoc:"",count:null}},computed:{doc(){return this.$route.params._id}},mounted(){this.fetchData()},methods:{onNewDocumentCreated(e){this.fetchData(),this.$refs.modal.hide(),this.$router.replace({name:"document",params:{_id:e._id}})},async submit(){await this.api.create(JSON.parse(this.newDoc)),this.$refs.modal.hide(),this.newDoc="",await this.fetchData()},async fetchData(){const{data:e}=await this.api.find({},{},{sort:{createdAt:-1}});this.documents=e,this.fetchCount()},async removeDocument(e){await this.api.deleteOne({_id:e._id});let{collection:t,project:c}=this;this.$router.replace({name:"documents",params:{project:c,collection:t}}).then(),await this.fetchData()},async fetchCount(){const{data:e}=await this.api.count();this.count=e}}},A={class:"Documents"},I={class:"side-bar"},T={class:"head flex justify-between items-center w-full"},F=o("h1",{class:""},"Documents",-1),O={key:0,class:"count"},S={class:"items"},q=["onClick"],E={class:"document relative"},J={class:"new-document"};function L(e,t,c,u,m,i){const p=s("DeleteIcon"),f=s("router-link"),D=s("router-view"),v=s("CreateDocument"),w=s("Modal");return a(),d("div",A,[o("div",I,[o("div",T,[F,m.count?(a(),d("div",O,_(m.count)+"#",1)):b("",!0)]),o("button",{class:"btn btn-sm btn-text",onClick:t[0]||(t[0]=n=>e.$refs.modal.show())}," New Document "),o("div",S,[(a(!0),d(N,null,g(m.documents,n=>(a(),h(f,{class:"item",to:{name:"document",params:{project:u.project,collection:u.collection,_id:n._id}}},{default:l(()=>[j(_(n._id.substring(10))+" ",1),o("div",{class:"drop",onClick:R=>i.removeDocument(n)},[r(p,{class:"fill-red-500 opacity-75",width:"24",height:"24"})],8,q)]),_:2},1032,["to"]))),256))])]),o("div",E,[r(x,{name:"fade"},{default:l(()=>[(a(),h(D,{key:i.doc,onDeleteDocument:i.removeDocument},null,8,["onDeleteDocument"]))]),_:1})]),r(w,{ref:"modal"},{default:l(()=>[o("div",J,[r(v,{onCreated:i.onNewDocumentCreated,onCancel:t[1]||(t[1]=n=>e.$refs.modal.hide())},null,8,["onCreated"])])]),_:1},512)])}var U=k(V,[["render",L]]);export{U as default};
