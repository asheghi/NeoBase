import{A as M,s as _,t as B}from"./api.6f9d2f33.js";/* empty css                                                   */import{_ as A,r as w,o as c,a as u,b as s,n as J,e as b,w as m,g as v,h as y,k as f,F as N,j as R,p as V,v as O,y as D,t as p,d as g}from"./index.af53e14a.js";import{N as E}from"./N-Button.df8eb929.js";function U(e){try{return JSON.stringify(e,null,"    ")}catch{return e}}const F={name:"JsonEditor",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const n=w(U(e.modelValue)),i=w(!1);return{onChange:a=>{const h=a.target.value;try{const d=JSON.parse(h);n.value=U(d),t("update:modelValue",d),i.value=!1}catch{i.value=!0}},value:n,invalid:i}}},I={class:"JsonEditor"},T=["value"];function j(e,t,n,i,l,a){return c(),u("div",I,[s("textarea",{value:i.value,class:J({invalid:i.invalid}),onChange:t[0]||(t[0]=(...h)=>i.onChange&&i.onChange(...h))},null,42,T)])}var L=A(F,[["render",j]]),q="/assets/plus.b1e6f0a3.svg";const S={createdBy:"$uid"},z={name:"ConfigEditor",components:{NButton:E,JsonEditor:L,IconAdd:q},props:{config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(e){const t=w(e.config),n=JSON.parse(JSON.stringify(e.config));return{tempConfig:t,initialConfig:n}},computed:{hasUnAuthenticatedRole(){return this.tempConfig.find(e=>!e.user)},hasAuthenticatedRole(){return this.tempConfig.find(e=>e.user===!0)},configChanged(){try{let e=JSON.stringify(this.tempConfig),t=JSON.stringify(this.initialConfig);return console.log("check",e,t),e!==t}catch{return!0}}},methods:{getUserMode(e){return e.user&&e.user.role!==void 0?"role":e.user===!0?"authed":"un_authed"},removeRole(e){this.tempConfig.splice(e,1)},addRole(){this.hasUnAuthenticatedRole?this.hasAuthenticatedRole?this.tempConfig.splice(0,0,{user:{role:""},create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!0,create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!1,create:!1,read:!1,delete:!1,update:!1})},getFilterMode(e){return e?e===!0?"all":JSON.stringify(S)===JSON.stringify(e)?"own":"custom":"none"},onUserModeChanged(e,t){const n=t.target.value;this.getUserMode(e)!==n&&(n==="role"?e.user={role:""}:e.user=n==="authed")},onFilterChanged(e,t,n){const i=e[t],l=n.target.value;i!==l&&(l==="none"?e[t]=!1:l==="all"?e[t]=!0:l==="own"?e[t]=S:e[t]={})},discardChanges(){this.tempConfig.splice(0,this.tempConfig.length),this.tempConfig.push(...this.initialConfig)},saveChanges(){this.$emit("save",this.tempConfig)}}},Y={class:"ConfigEditor"},G={class:"flex pb-4 gap-4 items-center"},H=s("span",{class:"ml-auto"},null,-1),K={class:"user w-full flex gap-4 items-center mb-2"},P=["value","onChange"],Q=s("option",{value:"role"},"users with role",-1),W=s("option",{value:"authed"},"authenticated users",-1),X=s("option",{value:"un_authed"},"un-authenticated users",-1),Z=[Q,W,X],$=["onUpdate:modelValue"],ee=["onClick"],te={class:"access flex flex-col justify-center space-y-2 px-4"},se={class:"create flex items-center gap-1 w-full"},ne=["id","onUpdate:modelValue","disabled"],ae=["for"],oe=["value","disabled","onChange"],ie={value:"all"},le={value:"own"},re={value:"custom"},ce={value:"none"},de=s("br",null,null,-1);function ue(e,t,n,i,l,a){const h=g("IconAdd"),d=g("NButton"),k=g("JsonEditor");return c(),u("div",Y,[s("div",G,[b(d,{class:"primary",disabled:n.loading,onClick:a.addRole},{default:m(()=>[b(h),v(" Add Role ")]),_:1},8,["disabled","onClick"]),a.configChanged?(c(),y(d,{key:0,disabled:n.loading,class:"",onClick:a.discardChanges},{default:m(()=>[v(" Discard changes ")]),_:1},8,["disabled","onClick"])):f("",!0),H,a.configChanged?(c(),y(d,{key:1,loading:n.loading,class:"success",onClick:a.saveChanges},{default:m(()=>[v(" Save Changes ")]),_:1},8,["loading","onClick"])):f("",!0)]),(c(!0),u(N,null,R(i.tempConfig,(r,C)=>(c(),u("div",{key:C,class:"config mb-4 border px-2 py-4 card"},[s("div",K,[s("select",{value:a.getUserMode(r),onChange:o=>a.onUserModeChanged(r,o)},Z,40,P),a.getUserMode(r)==="role"?V((c(),u("input",{key:0,"onUpdate:modelValue":o=>r.user.role=o,type:"text"},null,8,$)),[[O,r.user.role]]):f("",!0),s("button",{class:"text-white ml-auto bg-red-400 px-2 py-1 rounded",onClick:o=>a.removeRole(C)}," Remove Role ",8,ee)]),s("div",te,[s("div",se,[V(s("input",{id:"create_"+C,"onUpdate:modelValue":o=>r.create=o,name:"create",type:"checkbox",disabled:n.loading,textContent:"can create"},null,8,ne),[[D,r.create]]),s("label",{for:"create_"+C},"can create documents",8,ae)]),(c(),u(N,null,R(["read","update","delete"],o=>s("div",{key:o,class:J(o)},[s("select",{value:a.getFilterMode(r[o]),class:"w-full",disabled:n.loading,onChange:x=>a.onFilterChanged(r,o,x)},[s("option",ie,"can "+p(o)+" all documents",1),s("option",le,"can "+p(o)+" documents created by him",1),s("option",re,"can "+p(o)+" some documents",1),s("option",ce,"can't "+p(o)+" any documents",1)],40,oe),a.getFilterMode(r[o])==="custom"?(c(),y(k,{key:0,modelValue:r[o],"onUpdate:modelValue":x=>r[o]=x},null,8,["modelValue","onUpdate:modelValue"])):f("",!0)],2)),64))]),de]))),128))])}var he=A(z,[["render",ue]]),fe="/assets/lock-reset.ec62b36e.svg";const ge={name:"AccessConfig",components:{NButton:E,ConfigEditor:he,IconReset:fe},beforeRouteUpdate(){this.fetchData()},data(){return{accessConfig:null,render_counter:1,loading:!1,fetching:!1}},computed:{api(){return M.AccessControl()},collection(){return this.$route.params.collection}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:e}=await this.api.getAccessConfig(this.collection);this.accessConfig=e}catch(e){console.error(e)}finally{this.fetching=!1}},async resetConfig(){const{isConfirmed:e}=await _.fire({title:"Reset Config",text:"Are you sure?",cancelButtonText:"cancel",cancelButtonColor:"gray",confirmButtonText:"Yes, reset config",confirmButtonColor:"red",showCancelButton:!0,preConfirm:async t=>{if(!t)return t;_.showLoading(_.getConfirmButton());try{await this.api.resetConfig(this.collection),await this.fetchData(),this.render_counter++,_.close(),B("Config has been reset")}catch(n){console.error(n)}finally{_.hideLoading()}}})},async updateConfig(e){try{this.loading=!0,await this.api.updateConfig(this.collection,e),this.render_counter++,B("Saved Changes")}catch(t){console.error(t)}finally{this.loading=!1}}}},_e={class:"AccessConfig"},pe={class:"card mb-4"},Ce={class:"flex header"},me={class:"pl-2 normal-case"},ve=s("span",{class:"ml-auto"},null,-1),ye={key:1,class:"skeloading"};function be(e,t,n,i,l,a){const h=g("IconReset"),d=g("NButton"),k=g("ConfigEditor");return c(),u("div",_e,[s("div",pe,[s("div",Ce,[v(" Access Config "),s("span",me,p(a.collection),1),ve,b(d,{class:"",onClick:a.resetConfig},{default:m(()=>[b(h)]),_:1},8,["onClick"])])]),l.fetching?f("",!0):(c(),y(k,{key:l.render_counter,config:l.accessConfig,loading:l.loading,onSave:a.updateConfig},null,8,["config","loading","onSave"])),l.fetching?(c(),u("div",ye)):f("",!0)])}var Be=A(ge,[["render",be]]);export{Be as default};
