import{_ as U,m as b,b as d,o as l,c,a as s,w as h,v as w,d as _,e as p,B,g as k,p as D,F as g,z as M,k as y,n as V,T,h as v,t as j}from"./index.81fc11e4.js";import{A as N,S as u,t as S}from"./api.d99f241a.js";import{D as A}from"./trash.e7e5085f.js";import{N as z}from"./N-Button.ab045c10.js";import{M as E}from"./Modal.11011273.js";const F={name:"NewUser",components:{NButton:z},emits:["created"],setup(){const e=b().params.project;return{api:N.Users(e),project:e}},data(){return{form:{},loading:!1}},methods:{async submit(){if(!this.loading){this.loading=!0;try{const t=this.form,{data:e,status:n}=await this.api.newUser(t);this.$emit("created",e)}finally{this.loading=!1}}}}},K={class:"NewUser"},L={class:"form-group"},R=s("label",{for:"email"},"Email",-1),I=["disabled"],P={class:"form-group"},Y=s("label",{for:"password"},"Password",-1),q=["disabled"],G={class:"form-group"},H=s("label",{for:"role"},"Role:",-1),J=["disabled"],O=k(" Submit ");function Q(t,e,n,m,o,a){const f=d("NButton");return l(),c("div",K,[s("div",{class:"form",onKeydown:e[3]||(e[3]=B((...r)=>a.submit&&a.submit(...r),["enter"]))},[s("div",L,[R,h(s("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=r=>o.form.email=r),name:"email",type:"email",disabled:o.loading,placeholder:"enter your email address"},null,8,I),[[w,o.form.email]])]),s("div",P,[Y,h(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>o.form.password=r),name:"password",type:"password",disabled:o.loading,placeholder:"enter a secure password"},null,8,q),[[w,o.form.password]])]),s("div",G,[H,h(s("input",{id:"role","onUpdate:modelValue":e[2]||(e[2]=r=>o.form.role=r),name:"role",type:"text",disabled:o.loading,placeholder:"enter a user role"},null,8,J),[[w,o.form.role]])]),_(f,{loading:o.loading,class:"primary",onClick:a.submit},{default:p(()=>[O]),_:1},8,["loading","onClick"])],32)])}var W=U(F,[["render",Q]]);const X={name:"Users",components:{Modal:E,NewUser:W,DeleteIcon:A},setup(){const t=b(),e=t.params.project,n=D(()=>t.params.uid);return{api:N.Users(e),uid:n}},data(){return{users:[],fetching:!1}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:t}=await this.api.find();this.users=t}catch(t){console.error(t)}finally{this.fetching=!1}},showNewUserModal(){this.$refs.modal.show()},async deleteUser(t){await u.fire({title:"Delete User",html:"Are you sure?",cancelButtonText:"cancel",customClass:{confirmButton:"danger",cancelButton:"secondary"},confirmButtonText:"Yes, Delete it",showCancelButton:!0,preConfirm:async e=>{if(e){u.showLoading(u.getConfirmButton());try{await this.api.deleteUser(t),await this.fetchData(),await this.$router.replace({name:"auth"}),S("Deleted User"),u.close()}catch(n){console.error(n)}return!1}return!1}})},async onCreated(t){this.$refs.modal.hide(),await this.fetchData(),await this.$router.push({name:"user",params:{uid:t._id}})}}},Z={class:"Users"},$=s("div",{class:"header"},"Users",-1),ee={class:"items"},se=s("div",{class:"item h-8 skeloading"},null,-1),te=s("div",{class:"item h-8 skeloading"},null,-1),oe=s("div",{class:"item h-8 skeloading"},null,-1),re={key:0,class:"card user-info"};function ae(t,e,n,m,o,a){const f=d("router-link"),r=d("router-view"),x=d("NewUser"),C=d("Modal");return l(),c("div",Z,[s("div",{class:V(["side-bar card",{showingUser:m.uid}])},[$,s("button",{class:"px-4 text-primary dark:text-primary-300 font-bold py-2",onClick:e[0]||(e[0]=(...i)=>a.showNewUserModal&&a.showNewUserModal(...i))}," New User "),s("div",ee,[o.fetching?y("",!0):(l(!0),c(g,{key:0},M(o.users,i=>(l(),v(f,{key:i,to:{name:"user",params:{uid:i._id}},class:"item name"},{default:p(()=>[k(j(i.email),1)]),_:2},1032,["to"]))),128)),o.fetching?(l(),c(g,{key:1},[se,te,oe],64)):y("",!0)])],2),m.uid?(l(),c("div",re,[_(T,{name:"fade"},{default:p(()=>[(l(),v(r,{key:m.uid,onDelete:e[1]||(e[1]=i=>a.deleteUser(i))}))]),_:1})])):y("",!0),_(C,{ref:"modal"},{default:p(()=>[_(x,{onCreated:a.onCreated},null,8,["onCreated"])]),_:1},512)])}var me=U(X,[["render",ae]]);export{me as default};
