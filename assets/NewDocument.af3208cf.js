import{g as p,A as f,t as u}from"./api.6f9d2f33.js";import{_ as g,u as v,r as l,c as y,o as C,a as D,e as m,b as _,w as x,g as w,t as N,n as B,d as h}from"./index.af53e14a.js";/* empty css                                                   */import{J as k}from"./JsonInput.625ef831.js";import{N as M}from"./N-Button.df8eb929.js";p("document-editor");const i=p("create-document"),b={name:"CreateDocument",components:{NButton:M,JsonInput:k},props:{doc:{type:Object,default:()=>({foo:"bar"})},hideId:{type:Boolean,default:!1,required:!1}},emits:["created","cancel"],setup(e){const{collection:o}=v().params,d=l("json"),n=y(()=>d.value==="json"?"editor":"json"),c=()=>{d.value=n.value},t={...e.doc},s=e.doc._id?String(e.doc._id):null,r=s?"edit":"create";delete t._id,delete t.createdAt,delete t.updatedAt,delete t.createdBy,delete t.__v;const a=l(t);return{documentId:s,mode:r,document:a,collection:o,api:f.Documents(o),currentMode:d,alternateMode:n,toggleMode:c}},data(){return{loading:!1}},computed:{document_id(){return this.mode==="create"?"new ObjectId()":this.doc._id}},methods:{async createDocument(){if(!this.document){i.error("this.document is not defined!",this.document);return}""in this.document&&delete this.document[""];try{this.loading=!0;const{data:e}=await this.api.create(this.document);this.$emit("created",e),u("created new document")}catch(e){i.error(e)}finally{this.loading=!1}},async updateDocument(){if(!this.document){i.error("this.document is not defined!",this.document);return}try{""in this.document&&delete this.document[""];const e={_id:this.document_id};this.loading=!0,await this.api.updateOne(e,this.document),this.$emit("updated",this.document_id),u("updated document")}catch(e){i.error(e)}finally{this.loading=!1}},onCancel(){this.$emit("cancel",!0)},toggleAlternateMode(){this.currentMode=this.alternateMode},onSave(){this.mode==="edit"?this.updateDocument():this.createDocument()},updatedJson(e){console.log("check arg",e)}}},I={class:"buttons"};function S(e,o,d,n,c,t){const s=h("JsonInput"),r=h("NButton");return C(),D("div",{class:B(["NewDocument","mode-"+n.currentMode])},[m(s,{modelValue:n.document,"onUpdate:modelValue":o[0]||(o[0]=a=>n.document=a)},null,8,["modelValue"]),_("div",I,[_("button",{class:"text-primary dark:text-white",onClick:o[1]||(o[1]=(...a)=>t.onCancel&&t.onCancel(...a)),textContent:"cancel"}),m(r,{loading:c.loading,class:"primary",onClick:t.onSave},{default:x(()=>[w(N(c.loading?"Saving":"Save"),1)]),_:1},8,["loading","onClick"])])],2)}var E=g(b,[["render",S]]);export{E as C};
