import{_ as g,o as a,h as f,w as p,b as t,e as d,d as c,u as $,a as _,g as w,t as C,F as v,j as N,k as y,n as B,T as x}from"./index.af53e14a.js";import{M}from"./Modal.e5bc137a.js";import{A as b,s as r}from"./api.6f9d2f33.js";import{D as T}from"./trash.6ae5f1e4.js";import{C as A}from"./NewDocument.af3208cf.js";/* empty css                                                   */import"./JsonInput.625ef831.js";import"./N-Button.df8eb929.js";const V={name:"NewDocumentModal",components:{Modal:M,CreateDocument:A},emits:["created"],methods:{show(){this.$refs.modal.show()},onCreated(e){this.$refs.modal.hide(),this.$emit("created",e)}}},I={class:"new-document"};function L(e,o,l,m,n,s){const u=c("CreateDocument"),h=c("Modal");return a(),f(h,{ref:"modal"},{default:p(()=>[t("div",I,[d(u,{ref:"create",onCreated:s.onCreated,onCancel:o[0]||(o[0]=D=>e.$refs.modal.hide())},null,8,["onCreated"])])]),_:1},512)}var F=g(V,[["render",L]]);const O={name:"ManageDocuments",components:{NewDocumentModal:F,DeleteIcon:T},setup(){const{collection:e}=$().params,o=b.Documents(e);return{collection:e,api:o}},data(){return{documents:[],newDoc:"",count:null,fetching:!1}},computed:{doc(){return this.$route.params._id}},mounted(){this.fetchData()},methods:{onNewDocumentCreated(e){this.fetchData(),this.$refs.modal.hide(),this.$router.replace({name:"document",params:{_id:e._id}})},async submit(){await this.api.create(JSON.parse(this.newDoc)),this.$refs.modal.hide(),this.newDoc="",await this.fetchData()},async fetchData(){this.fetching=!0;try{const{data:e}=await this.api.find({},{},{sort:{createdAt:-1}});this.documents=e,this.fetchCount()}catch(e){console.error(e)}finally{this.fetching=!1}},async removeDocument(e){const{isConfirmed:o}=await r.fire({title:"Delete Document",text:"Are you sure?",cancelButtonText:"cancel",customClass:{confirmButton:"danger",cancelButton:"secondary"},confirmButtonText:"Yes, Delete it",showCancelButton:!0,preConfirm:async l=>{if(l){r.showLoading(r.getConfirmButton());try{const{data:m}=await this.api.deleteOne({_id:e._id});let{collection:n}=this;this.$router.replace({name:"documents",params:{collection:n}}).then(),await this.fetchData(),r.close()}finally{r.hideLoading()}}}})},async fetchCount(){const{data:e}=await this.api.count();this.count=e}}},S={class:"Documents"},j={class:"header"},z={class:"opacity-50"},E={class:"items"},J=["onClick"],R=t("div",{class:"item h-8 skeloading"},null,-1),Y=t("div",{class:"item h-8 skeloading"},null,-1),q=t("div",{class:"item h-8 skeloading"},null,-1),G={class:"document relative"};function H(e,o,l,m,n,s){const u=c("DeleteIcon"),h=c("router-link"),D=c("router-view"),k=c("NewDocumentModal");return a(),_("div",S,[t("div",{class:B(["side-bar card",{hide:!!s.doc}])},[t("div",j,[w(" Documents "),t("span",z," #"+C(n.count),1)]),t("button",{class:"btn btn-sm btn-text",onClick:o[0]||(o[0]=i=>e.$refs.modal.show())}," New Document "),t("div",E,[n.fetching?y("",!0):(a(!0),_(v,{key:0},N(n.documents,i=>(a(),f(h,{key:i._id,class:"item",to:{name:"document",params:{collection:m.collection,_id:i._id}}},{default:p(()=>[w(C(i._id.substr(8))+" ",1),t("div",{class:"drop",onClick:K=>s.removeDocument(i)},[d(u,{class:"fill-red-500 opacity-75",width:"24",height:"24"})],8,J)]),_:2},1032,["to"]))),128)),n.fetching?(a(),_(v,{key:1},[R,Y,q],64)):y("",!0)])],2),t("div",G,[d(x,{name:"fade"},{default:p(()=>[(a(),f(D,{key:s.doc,onDeleteDocument:s.removeDocument},null,8,["onDeleteDocument"]))]),_:1})]),d(k,{ref:"modal",onCreated:s.onNewDocumentCreated},null,8,["onCreated"])])}var oe=g(O,[["render",H]]);export{oe as default};
