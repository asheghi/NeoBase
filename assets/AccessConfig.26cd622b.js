import{A as w,S as k}from"./api.2151525c.js";import{J as A}from"./JsonEditor.ba11ed47.js";import{_ as y,r as R,a as x,o as i,c,d as t,x as h,F as p,t as C,w as m,v as U,D as M,y as d,n as S,h as b}from"./index.a259c8be.js";const v={createdBy:"$uid"},B={name:"ConfigEditor",components:{JsonEditor:A},props:{config:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(e){const s=R(e.config),r=JSON.parse(JSON.stringify(e.config));return{tempConfig:s,initialConfig:r}},computed:{hasUnAuthenticatedRole(){return this.tempConfig.find(e=>!e.user)},hasAuthenticatedRole(){return this.tempConfig.find(e=>e.user===!0)},configChanged(){try{let e=JSON.stringify(this.tempConfig),s=JSON.stringify(this.initialConfig);return console.log("check",e,s),e!==s}catch{return!0}}},methods:{getUserMode(e){return e.user&&e.user.role!==void 0?"role":e.user===!0?"authed":"un_authed"},removeRole(e){this.tempConfig.splice(e,1)},addRole(){this.hasUnAuthenticatedRole?this.hasAuthenticatedRole?this.tempConfig.splice(0,0,{user:{role:""},create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!0,create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!1,create:!1,read:!1,delete:!1,update:!1})},getFilterMode(e){return e?e===!0?"all":JSON.stringify(v)===JSON.stringify(e)?"own":"custom":"none"},onUserModeChanged(e,s){const r=s.target.value;this.getUserMode(e)!==r&&(r==="role"?e.user={role:""}:e.user=r==="authed")},onFilterChanged(e,s,r){const u=e[s],l=r.target.value;u!==l&&(l==="none"?e[s]=!1:l==="all"?e[s]=!0:l==="own"?e[s]=v:e[s]={})},discardChanges(){this.tempConfig.splice(0,this.tempConfig.length),this.tempConfig.push(...this.initialConfig)},saveChanges(){this.$emit("save",this.tempConfig)}}},E={class:"ConfigEditor"},J={class:"flex gap-4 items-center"},V={class:"user w-full flex gap-2 items-center mb-2"},D=["value","onChange"],N=t("option",{value:"role"},"users with role",-1),O=t("option",{value:"authed"},"authenticated users",-1),F=t("option",{value:"un_authed"},"un-authenticated users",-1),j=[N,O,F],T=["onUpdate:modelValue"],q=["onClick"],z={class:"access flex flex-col justify-center space-y-2 px-4"},L={class:"create flex items-center gap-1 w-full"},Y=["id","onUpdate:modelValue","textContent"],G=["for"],H=["value","onChange"],I={value:"all"},K={value:"own"},P={value:"custom"},Q={value:"none"},W=t("br",null,null,-1);function X(e,s,r,u,l,n){const g=x("JsonEditor");return i(),c("div",E,[t("div",J,[t("button",{class:"text-white bg-blue-500 rounded px-20 py-1 mb-4",onClick:s[0]||(s[0]=(...o)=>n.addRole&&n.addRole(...o))}," Add Role "),n.configChanged?(i(),c("button",{key:0,class:"text-white bg-gray-500 rounded px-8 py-1 mb-4",onClick:s[1]||(s[1]=(...o)=>n.discardChanges&&n.discardChanges(...o))}," discard changes ")):h("",!0),n.configChanged?(i(),c("button",{key:1,class:"ml-auto text-white bg-green-500 rounded px-2 py-1 mb-4",onClick:s[2]||(s[2]=(...o)=>n.saveChanges&&n.saveChanges(...o))}," Save Changes ")):h("",!0)]),(i(!0),c(p,null,C(u.tempConfig,(o,f)=>(i(),c("div",{key:f,class:"config mb-4 border px-2 rounded py-4"},[t("div",V,[t("select",{value:n.getUserMode(o),onChange:a=>n.onUserModeChanged(o,a)},j,40,D),n.getUserMode(o)==="role"?m((i(),c("input",{key:0,"onUpdate:modelValue":a=>o.user.role=a,type:"text"},null,8,T)),[[U,o.user.role]]):h("",!0),t("button",{class:"text-white ml-auto bg-red-400 px-2 py-1 rounded",onClick:a=>n.removeRole(f)}," Remove Role ",8,q)]),t("div",z,[t("div",L,[m(t("input",{id:"create_"+f,"onUpdate:modelValue":a=>o.create=a,name:"create",type:"checkbox",textContent:d("can create")},null,8,Y),[[M,o.create]]),t("label",{for:"create_"+f},"can create documents",8,G)]),(i(),c(p,null,C(["read","update","delete"],a=>t("div",{key:a,class:S(a)},[t("select",{value:n.getFilterMode(o[a]),class:"w-full",onChange:_=>n.onFilterChanged(o,a,_)},[t("option",I,"can "+d(a)+" all documents",1),t("option",K,"can "+d(a)+" documents created by him",1),t("option",P,"can "+d(a)+" some documents",1),t("option",Q,"can't "+d(a)+" any documents",1)],40,H),n.getFilterMode(o[a])==="custom"?(i(),b(g,{key:0,modelValue:o[a],"onUpdate:modelValue":_=>o[a]=_},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)],2)),64))]),W]))),128))])}var Z=y(B,[["render",X]]);const $={name:"AccessConfig",components:{ConfigEditor:Z},beforeRouteUpdate(){this.fetchData()},data(){return{accessConfig:null,render_counter:1}},computed:{api(){return w.AccessControl(this.project)},collection(){return this.$route.params.collection},project(){return this.$route.params.project}},mounted(){this.fetchData()},methods:{async fetchData(){const{data:e}=await this.api.getAccessConfig(this.collection);this.accessConfig=e},toggleEditMode(){this.mode=this.alternateMode},async resetConfig(){const{isConfirmed:e}=await k.fire({title:"Reset Config",text:"Are you sure?",cancelButtonText:"cancel",cancelButtonColor:"gray",confirmButtonText:"Yes, reset config",confirmButtonColor:"red",showCancelButton:!0});!e||(await this.api.resetConfig(this.collection),await this.fetchData(),this.render_counter++)},async updateConfig(e){await this.api.updateConfig(this.collection,e),await this.fetchData(),this.render_counter++}}},ee={class:"AccessConfig"},te={class:"flex"},se={class:"header"},ne={class:"actions ml-auto flex gap-4"},oe=t("br",null,null,-1);function ae(e,s,r,u,l,n){const g=x("ConfigEditor");return i(),c("div",ee,[t("div",te,[t("div",se,"Access Config of "+d(n.collection),1),t("div",ne,[t("button",{class:"text-red-400",onClick:s[0]||(s[0]=(...o)=>n.resetConfig&&n.resetConfig(...o))}," Reset to Default ")])]),oe,l.accessConfig?(i(),b(g,{key:l.render_counter,config:l.accessConfig,onSave:n.updateConfig},null,8,["config","onSave"])):h("",!0)])}var ce=y($,[["render",ae]]);export{ce as default};
