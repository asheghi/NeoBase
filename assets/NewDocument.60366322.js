var w=Object.defineProperty;var b=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var x=(t,e,o)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,v=(t,e)=>{for(var o in e||(e={}))M.call(e,o)&&x(t,o,e[o]);if(b)for(var o of b(e))j.call(e,o)&&x(t,o,e[o]);return t};import{o as s,c,d as n,_ as g,a as f,y as r,b as S,x as h,F,t as $,h as y,k as E,r as V,l as U,n as I}from"./index.d25bbfa4.js";import{g as D,A as N}from"./api.0d84de39.js";import{J as O}from"./JsonEditor.c63460a5.js";const C={xmlns:"http://www.w3.org/2000/svg",class:"ionicon",viewBox:"0 0 512 512"},A=n("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),B=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 256H176"},null,-1),R=[A,B];function J(t,e){return s(),c("svg",C,R)}C.width="24";C.height="24";var K={render:J};const q={name:"DocumentField",components:{RemoveIcon:K},props:{fieldKey:{type:String,required:!0,default:""},fieldValue:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{selected_type:null}},computed:{type(){const{selected_type:t}=this;if(t)return t;if(!String(this.fieldValue))return"text";const e=typeof this.fieldValue;if(console.log("typeof ",e),e==="boolean")return"boolean";if(e==="string"&&this.fieldValue.length===24&&this.fieldValue.endsWith("Z"))return"date-time";if(e==="object"){if(Array.isArray(this.fieldValue))return"array";if(this.fieldValue)return"object"}return isNaN(this.fieldValue)?"text":"number"}}},z={class:"Field"},L={class:"key"},H=n("label",{for:"key"},"Field",-1),T=["value"],W=n("div",{class:"dotted-line"},null,-1),Z=n("div",{class:"equal"},"=",-1),G={class:"type"},P=n("label",{for:"type"},"Type",-1),Q=["value"],X=["textContent"],Y=["textContent"],ee=["textContent"],te=["textContent"],ne=["textContent"],oe=["textContent"],de={class:"value"},le=n("label",{for:"value"},"Value",-1),ie=n("br",null,null,-1),se=["value"],ue=["value"],ae=["value"],re=["textContent"],ce=["textContent"],me=["value"],_e={key:0,class:"remove-icon"};function he(t,e,o,l,m,i){const a=f("RemoveIcon");return s(),c("div",z,[n("div",L,[H,n("input",{id:"key",name:"key",value:o.fieldKey,placeholder:"key",onChange:e[0]||(e[0]=d=>t.$emit("update:field-key",d.target.value,o.fieldKey))},null,40,T),W]),Z,n("div",G,[P,n("select",{id:"type",value:i.type,onChange:e[1]||(e[1]=d=>m.selected_type=d.target.value)},[n("option",{value:"text",textContent:r("text")},null,8,X),n("option",{value:"number",textContent:r("number")},null,8,Y),n("option",{value:"boolean",textContent:r("boolean")},null,8,ee),n("option",{value:"date-time",textContent:r("date-time")},null,8,te),n("option",{value:"array",textContent:r("array")},null,8,ne),n("option",{value:"map",textContent:r("map")},null,8,oe)],40,Q)]),n("div",de,[le,ie,i.type==="number"?(s(),c("input",{key:0,id:"value",type:"number",value:o.fieldValue,name:"value",placeholder:"value",onChange:e[2]||(e[2]=d=>t.$emit("update:field-value",+d.target.value))},null,40,se)):i.type==="text"?(s(),c("input",{key:1,id:"value",value:o.fieldValue,name:"value",placeholder:"value",onChange:e[3]||(e[3]=d=>t.$emit("update:field-value",d.target.value))},null,40,ue)):i.type==="boolean"?(s(),c("select",{key:2,id:"type",value:o.fieldValue,onChange:e[4]||(e[4]=d=>t.$emit("update:field-value",Boolean(d.target.value)))},[n("option",{value:!0,textContent:r("true")},null,8,re),n("option",{value:!1,textContent:r("false")},null,8,ce)],40,ae)):(s(),c("textarea",{key:3,id:"type",value:o.fieldValue,onChange:e[5]||(e[5]=d=>t.$emit("update:field-value",JSON.parse(d.target.value)))},null,40,me))]),o.fieldKey?(s(),c("button",_e,[S(a,{class:"icon",width:"24",height:"24",onClick:e[6]||(e[6]=d=>t.$emit("remove"))})])):h("",!0)])}var fe=g(q,[["render",he]]);const p=D("document-editor"),ve={name:"DocumentEditor",components:{DocumentField:fe},props:{modelValue:{default:{}}},data(){return{document:this.modelValue||{"":""},render_counter:1}},watch:{render_counter(){Object.keys(this.document).find(t=>t==="")||(this.document[""]="")}},mounted(){this.render_counter++},methods:{onKeyChange(t,e){p.debug(`on key changed, new:${t}, old:${e}`),this.document[String(t)]=this.document[e],delete this.document[e],p.debug("after: ",this.document),this.render_counter++,this.fireUpdate()},onValueChanged(t,e){p.debug("onValueChanged",t,typeof t,e,typeof e),this.document[String(t)]=e,this.render_counter++,this.fireUpdate()},fireUpdate(){const t=v({},this.document);delete t[""],console.log("check",t),this.$emit("update:modelValue",t)},removeField(t){!t||(delete this.document[t],this.fireUpdate())}}},pe={class:"DocumentEditor"};function ye(t,e,o,l,m,i){const a=f("DocumentField");return s(),c("div",pe,[(s(!0),c(F,null,$(Object.keys(m.document),(d,u)=>(s(),y(a,{key:u,"field-key":String(d),"field-value":m.document[d],"onUpdate:fieldKey":i.onKeyChange,"onUpdate:fieldValue":_=>i.onValueChanged(d,_),onRemove:_=>i.removeField(d)},null,8,["field-key","field-value","onUpdate:fieldKey","onUpdate:fieldValue","onRemove"]))),128))])}var ge=g(ve,[["render",ye]]);const k=D("create-document"),Ce={name:"CreateDocument",components:{JsonEditor:O,DocumentEditor:ge},props:{doc:{type:Object,default:()=>({"":""})},hideId:{type:Boolean,default:!1,required:!1}},emits:["created","cancel"],setup(t){const{project:e,collection:o}=E().params,l=V("json"),m=U(()=>l.value==="json"?"editor":"json"),i=()=>{l.value=m.value},a=v({},t.doc),d=t.doc._id?String(t.doc._id):null,u=d?"edit":"create";delete a._id,delete a.createdAt,delete a.updatedAt,delete a.__v;const _=V(a);return{documentId:d,mode:u,document:_,project:e,collection:o,api:N.Documents(e,o),currentMode:l,alternateMode:m,toggleMode:i}},computed:{document_id(){return this.mode==="create"?"new ObjectId()":this.document_id}},methods:{async createDocument(){if(!this.document){k.error("this.document is not defined!",this.document);return}""in this.document&&delete this.document[""];const{data:t,status:e}=await this.api.create(this.document);this.$emit("created",t)},async updateDocument(){if(!this.document){k.error("this.document is not defined!",this.document);return}""in this.document&&delete this.document[""],console.log("before update",this.document);const t={_id:this.document_id};await this.api.updateOne(t,this.document),this.$emit("updated",this.document_id)},onCancel(){this.$emit("cancel",!0)},toggleAlternateMode(){this.currentMode=this.alternateMode},onSave(){this.mode==="edit"?this.updateDocument():this.createDocument()}}},be={key:0,class:"document-id"},xe=n("label",{for:"document_id"},"Document ID",-1),Ve=["value"],ke={class:"buttons"},De=["textContent"],we=["textContent"],Me=["textContent"],je=n("div",{class:"border-left"},null,-1);function Se(t,e,o,l,m,i){const a=f("DocumentEditor"),d=f("JsonEditor");return s(),c("div",{class:I(["NewDocument","mode-"+l.currentMode])},[o.hideId?h("",!0):(s(),c("div",be,[xe,n("input",{id:"document_id",disabled:"disabled",type:"text",value:i.document_id,placeholder:"document id"},null,8,Ve)])),l.currentMode==="editor"?(s(),y(a,{key:1,modelValue:l.document,"onUpdate:modelValue":e[0]||(e[0]=u=>l.document=u)},null,8,["modelValue"])):h("",!0),l.currentMode==="json"?(s(),y(d,{key:2,modelValue:l.document,"onUpdate:modelValue":e[1]||(e[1]=u=>l.document=u)},null,8,["modelValue"])):h("",!0),n("div",ke,[n("button",{class:"btn btn-text btn-sm mr-auto",onClick:e[2]||(e[2]=(...u)=>l.toggleMode&&l.toggleMode(...u)),textContent:r(l.alternateMode)},null,8,De),n("button",{class:"btn btn-text btn-sm",onClick:e[3]||(e[3]=(...u)=>i.onCancel&&i.onCancel(...u)),textContent:r("cancel")},null,8,we),n("button",{class:"btn save",onClick:e[4]||(e[4]=(...u)=>i.onSave&&i.onSave(...u)),textContent:r("Save")},null,8,Me)]),je],2)}var Ie=g(Ce,[["render",Se]]);export{Ie as C};
