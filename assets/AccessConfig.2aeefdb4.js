import{A as U,S as M}from"./api.9cb1a443.js";import{J as V}from"./JsonEditor.794bd79a.js";import{_ as R,r as E,b as f,o as i,c as l,a as t,d as x,e as p,h as C,k as _,F as k,z as B,w as b,v as S,E as J,t as d,n as D,g as m}from"./index.e2c66d80.js";import{N as A}from"./N-Button.66bfda2d.js";const N={createdBy:"$uid"},O={name:"ConfigEditor",components:{NButton:A,JsonEditor:V},props:{config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(e){const s=E(e.config),r=JSON.parse(JSON.stringify(e.config));return{tempConfig:s,initialConfig:r}},computed:{hasUnAuthenticatedRole(){return this.tempConfig.find(e=>!e.user)},hasAuthenticatedRole(){return this.tempConfig.find(e=>e.user===!0)},configChanged(){try{let e=JSON.stringify(this.tempConfig),s=JSON.stringify(this.initialConfig);return console.log("check",e,s),e!==s}catch{return!0}}},methods:{getUserMode(e){return e.user&&e.user.role!==void 0?"role":e.user===!0?"authed":"un_authed"},removeRole(e){this.tempConfig.splice(e,1)},addRole(){this.hasUnAuthenticatedRole?this.hasAuthenticatedRole?this.tempConfig.splice(0,0,{user:{role:""},create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!0,create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!1,create:!1,read:!1,delete:!1,update:!1})},getFilterMode(e){return e?e===!0?"all":JSON.stringify(N)===JSON.stringify(e)?"own":"custom":"none"},onUserModeChanged(e,s){const r=s.target.value;this.getUserMode(e)!==r&&(r==="role"?e.user={role:""}:e.user=r==="authed")},onFilterChanged(e,s,r){const u=e[s],c=r.target.value;u!==c&&(c==="none"?e[s]=!1:c==="all"?e[s]=!0:c==="own"?e[s]=N:e[s]={})},discardChanges(){this.tempConfig.splice(0,this.tempConfig.length),this.tempConfig.push(...this.initialConfig)},saveChanges(){this.$emit("save",this.tempConfig)}}},F={class:"ConfigEditor"},j={class:"flex pb-4 gap-4 items-center"},$=m(" Add Role "),T=m(" Discard changes "),I=t("span",{class:"ml-auto"},null,-1),z=m(" Save Changes "),L={class:"user w-full flex gap-2 items-center mb-2"},q=["value","onChange"],Y=t("option",{value:"role"},"users with role",-1),Z=t("option",{value:"authed"},"authenticated users",-1),G=t("option",{value:"un_authed"},"un-authenticated users",-1),H=[Y,Z,G],K=["onUpdate:modelValue"],P=["onClick"],Q={class:"access flex flex-col justify-center space-y-2 px-4"},W={class:"create flex items-center gap-1 w-full"},X=["id","onUpdate:modelValue","textContent"],ee=["for"],te=["value","onChange"],se={value:"all"},oe={value:"own"},ne={value:"custom"},ae={value:"none"},ie=t("br",null,null,-1);function ce(e,s,r,u,c,n){const h=f("NButton"),y=f("JsonEditor");return i(),l("div",F,[t("div",j,[x(h,{class:"primary",onClick:n.addRole},{default:p(()=>[$]),_:1},8,["onClick"]),n.configChanged?(i(),C(h,{key:0,class:"",onClick:n.discardChanges},{default:p(()=>[T]),_:1},8,["onClick"])):_("",!0),I,n.configChanged?(i(),C(h,{key:1,class:"success",onClick:n.saveChanges},{default:p(()=>[z]),_:1},8,["onClick"])):_("",!0)]),(i(!0),l(k,null,B(u.tempConfig,(a,g)=>(i(),l("div",{key:g,class:"config mb-4 border px-2 py-4 card"},[t("div",L,[t("select",{value:n.getUserMode(a),onChange:o=>n.onUserModeChanged(a,o)},H,40,q),n.getUserMode(a)==="role"?b((i(),l("input",{key:0,"onUpdate:modelValue":o=>a.user.role=o,type:"text"},null,8,K)),[[S,a.user.role]]):_("",!0),t("button",{class:"text-white ml-auto bg-red-400 px-2 py-1 rounded",onClick:o=>n.removeRole(g)}," Remove Role ",8,P)]),t("div",Q,[t("div",W,[b(t("input",{id:"create_"+g,"onUpdate:modelValue":o=>a.create=o,name:"create",type:"checkbox",textContent:d("can create")},null,8,X),[[J,a.create]]),t("label",{for:"create_"+g},"can create documents",8,ee)]),(i(),l(k,null,B(["read","update","delete"],o=>t("div",{key:o,class:D(o)},[t("select",{value:n.getFilterMode(a[o]),class:"w-full",onChange:w=>n.onFilterChanged(a,o,w)},[t("option",se,"can "+d(o)+" all documents",1),t("option",oe,"can "+d(o)+" documents created by him",1),t("option",ne,"can "+d(o)+" some documents",1),t("option",ae,"can't "+d(o)+" any documents",1)],40,te),n.getFilterMode(a[o])==="custom"?(i(),C(y,{key:0,modelValue:a[o],"onUpdate:modelValue":w=>a[o]=w},null,8,["modelValue","onUpdate:modelValue"])):_("",!0)],2)),64))]),ie]))),128))])}var re=R(O,[["render",ce]]);const v={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},le=t("path",{d:"M12.63 2c5.53 0 10.01 4.5 10.01 10s-4.48 10-10.01 10c-3.51 0-6.58-1.82-8.37-4.57l1.58-1.25C7.25 18.47 9.76 20 12.64 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8C8.56 4 5.2 7.06 4.71 11h2.76l-3.74 3.73L0 11h2.69c.5-5.05 4.76-9 9.94-9m2.96 8.24c.5.01.91.41.91.92v4.61c0 .5-.41.92-.92.92h-5.53c-.51 0-.92-.42-.92-.92v-4.61c0-.51.41-.91.91-.92V9.23c0-1.53 1.25-2.77 2.77-2.77 1.53 0 2.78 1.24 2.78 2.77v1.01m-2.78-2.38c-.75 0-1.37.61-1.37 1.37v1.01h2.75V9.23c0-.76-.62-1.37-1.38-1.37Z"},null,-1),de=[le];function ue(e,s){return i(),l("svg",v,de)}v.width="24";v.height="24";v.viewBox="0 0 24 24";var he={render:ue};const _e={name:"AccessConfig",components:{NButton:A,ConfigEditor:re,IconReset:he},beforeRouteUpdate(){this.fetchData()},data(){return{accessConfig:null,render_counter:1,loading:!1}},computed:{api(){return U.AccessControl(this.project)},collection(){return this.$route.params.collection},project(){return this.$route.params.project}},mounted(){this.fetchData()},methods:{async fetchData(){const{data:e}=await this.api.getAccessConfig(this.collection);this.accessConfig=e},toggleEditMode(){this.mode=this.alternateMode},async resetConfig(){const{isConfirmed:e}=await M.fire({title:"Reset Config",text:"Are you sure?",cancelButtonText:"cancel",cancelButtonColor:"gray",confirmButtonText:"Yes, reset config",confirmButtonColor:"red",showCancelButton:!0});if(!!e){this.loading=!0;try{await this.api.resetConfig(this.collection),await this.fetchData(),this.render_counter++}catch(s){console.error(s)}finally{this.loading=!1}}},async updateConfig(e){try{this.loading=!0,await this.api.updateConfig(this.collection,e),await this.fetchData(),this.render_counter++}catch(s){console.error(s)}finally{this.loading=!1}}}},fe={class:"AccessConfig"},ge={class:"card"},pe={class:"flex header"},Ce=m(" Access Config "),me={class:"pl-2 normal-case"},ve=t("span",{class:"ml-auto"},null,-1),ye=t("br",null,null,-1);function we(e,s,r,u,c,n){const h=f("IconReset"),y=f("NButton"),a=f("ConfigEditor");return i(),l("div",fe,[t("div",ge,[t("div",pe,[Ce,t("span",me,d(n.collection),1),ve,x(y,{class:"",onClick:n.resetConfig},{default:p(()=>[x(h)]),_:1},8,["onClick"])])]),ye,c.accessConfig?(i(),C(a,{key:c.render_counter,config:c.accessConfig,onSave:n.updateConfig,loading:c.loading},null,8,["config","onSave","loading"])):_("",!0)])}var Ne=R(_e,[["render",we]]);export{Ne as default};
